---
title: "WPLCP"
output: html_document
date: '2022-07-18'
---

```{r}
library(plant)
library(dplyr)
library(tidyr)
library(ggplot2)
library(purrr)
```

The light level at which carbon gain becomes zero is the “whole plant light compensation point”.
```{r}
openness <- seq(0, 1, length.out=51)
lcp <- 0.299
```

Height growth rate increases in a saturating fashion with increasing canopy openness from the light compensation point.
```{r }
f <- function(x, indv) {
  env <- FF16_fixed_environment(x)
  indv$compute_rates(env)
  indv$rate("height")
}

x <- c(lcp, openness[openness > lcp])

params <- scm_base_parameters("FF16")
```

LMA
```{r}
s1 <- strategy(trait_matrix(0.07, "lma"), params)
s2 <- strategy(trait_matrix(0.125, "lma"), params)
s3 <- strategy(trait_matrix(0.24, "lma"), params)

indv1 <- FF16_Individual(s1)
indv2 <- FF16_Individual(s2)
indv3 <- FF16_Individual(s3)

## WPLCPs:
plot(x, sapply(x, f, indv1), type="l", xlim=c(0, 1),
     las=1, xlab="Canopy openness", ylab="Height growth rate (m / yr)")
lines(x, sapply(x, f, indv2), type="l", xlim=c(0, 1),
     las=1, xlab="Canopy openness", ylab="Height growth rate (m / yr)")
lines(x, sapply(x, f, indv3), type="l", xlim=c(0, 1),
     las=1, xlab="Canopy openness", ylab="Height growth rate (m / yr)")

##
heights_1 <- seq(indv2$state("height"), indv1$strategy$hmat, length.out=20)
heights_2 <- seq(indv2$state("height"), indv2$strategy$hmat, length.out=20)
heights_3 <- seq(indv3$state("height"), indv3$strategy$hmat, length.out=20)

## grow to size???
lma_1 <- grow_individual_to_size(indv1, heights1, "height", FF16_fixed_environment(1.0))
lma_2 <- grow_individual_to_size(indv2, heights2, "height", FF16_fixed_environment(1.0))
lma_3 <- grow_individual_to_size(indv3, heights3, "height", FF16_fixed_environment(1.0))

```

Height at maturation
```{r}
params <- scm_base_parameters("FF16")

h10 <- strategy(trait_matrix(10, "hmat"), params)
h25 <- strategy(trait_matrix(25, "hmat"), params)
h40 <- strategy(trait_matrix(40, "hmat"), params)

indv_h1 <- FF16_Individual(h10)
indv_h2 <- FF16_Individual(h25)
indv_h3 <- FF16_Individual(h40)

## WPLCPs:
plot(x, sapply(x, f, indv_h1), type="l", xlim=c(0, 1),
     las=1, xlab="Canopy openness", ylab="Height growth rate (m / yr)")
lines(x, sapply(x, f, indv_h2), type="l", xlim=c(0, 1),
     las=1, xlab="Canopy openness", ylab="Height growth rate (m / yr)")
lines(x, sapply(x, f, indv_h3), type="l", xlim=c(0, 1),
     las=1, xlab="Canopy openness", ylab="Height growth rate (m / yr)")

##
heights_1 <- seq(indv_h1$state("height"), indv1$strategy$hmat, length.out=20)
heights_2 <- seq(indv_h2$state("height"), indv2$strategy$hmat, length.out=20)
heights_3 <- seq(indv_h3$state("height"), indv3$strategy$hmat, length.out=20)

## grow to size???
lma_1 <- grow_individual_to_size(indv1, heights1, "height", FF16_fixed_environment(1.0))
lma_2 <- grow_individual_to_size(indv2, heights2, "height", FF16_fixed_environment(1.0))
lma_3 <- grow_individual_to_size(indv3, heights3, "height", FF16_fixed_environment(1.0))
```


## net photosynthetic output against canopy openness
## plot where =0 across openness
## grow plant to height e.g. 10, 25, 40m - how does LCP vary across openness at each height?
## 
```{r}





```

